<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>pass_radials</title>
	<style>
		@font-face {
			font-family: "PassRadials Sans";
			src: url("./font/font_reg.ttf") format("truetype");
			font-weight: 400;   /* adjust if this TTF is a bold/medium/etc. */
			font-style: normal; /* or italic */
			font-display: swap; /* prevents invisible text while the font loads */
		}
	
		/* Use it across the site (with sensible fallbacks) */
		html, body {
			font-family: "PassRadials Sans", system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
		}
		header { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
		select { font-size: 16px; padding: 6px 10px; }
		#imgWrap { margin-top: 16px; }
		img { max-width: 100%; height: auto; border-radius: 12px; box-shadow: 0 4px 24px rgba(0,0,0,0.1); }
		#meta { margin-top: 8px; color: #555; font-size: 14px; }
		#status { margin-top: 12px; color: #a00; }
	</style>
</head>
<body style="background-color:powderblue;">
	<header>
		<div>
			<h1 style="margin:0;">pass_radials</h1>
		</div>
		<div style="margin-top: 10px; clear: both;">
			<label for="gameSelect">Game:</label>
			<select id="gameSelect" disabled>
				<option>Loading games…</option>
			</select>
		</div>
	</header>

	<div id="imgWrap">
		<img id="preview" alt="Select a game to view its radial" />
		<div id="meta"></div>
		<div id="status" role="status" aria-live="polite"></div>
	</div>

	<script>
		const SLUG_RE = /^(?<country>[a-z]+)-(?<comp>[a-z-]+)-(?<y1>\d{4})-(?<y2>\d{4})-(?<h>[a-z-]+)-(?<a>[a-z-]+)\.png$/;

		function titleCase(slug) {
			return slug.split("-").map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(" ");
		}

		function labelFromPath(path) {
			// expects "img/<slug>.png"
			const fname = path.split("/").pop();
			const m = fname.match(SLUG_RE);
			if (!m) return fname;
			const { country, comp, y1, y2, h, a } = m.groups;
			return `${y1}\u2013${y2} • ${titleCase(country)} ${titleCase(comp)} — ${titleCase(h)} vs ${titleCase(a)}`;
		}

		function setStatus(msg) {
			document.getElementById("status").textContent = msg || "";
		}

		(async function () {
			const q = new URLSearchParams(location.search);
			const initialId = q.get("id");
			const select = document.getElementById("gameSelect");
			const img = document.getElementById("preview");
			const meta = document.getElementById("meta");

			function labelOf(item) {
				return item.label || labelFromPath(item.img);
			}

			function show(item) {
				if (!item) return;
				img.src = item.img;
				img.alt = labelOf(item);
				meta.textContent = labelOf(item);
				const url = new URL(location.href);
				url.searchParams.set("id", item.id);
				history.replaceState(null, "", url);
			}

			try {
				const res = await fetch("data/index.json", { cache: "no-store" });
				if (!res.ok) throw new Error(`Failed to load manifest (status ${res.status})`);
				const data = await res.json();

				select.innerHTML = "";
				for (const item of data) {
					const opt = document.createElement("option");
					opt.value = item.id;
					opt.textContent = labelOf(item);
					select.appendChild(opt);
				}
				select.disabled = false;

				let current = data[0];
				if (initialId) {
					const found = data.find(d => d.id === initialId);
					if (found) current = found;
				}
				select.value = current.id;
				show(current);

				select.addEventListener("change", () => {
					const next = data.find(d => d.id === select.value);
					show(next);
				});

				img.addEventListener("error", () => setStatus("Couldn't load that image (404)."));
				img.addEventListener("load", () => setStatus(""));
			} catch (err) {
				setStatus(err.message);
			}
		})();
	</script>
</body>
</html>
